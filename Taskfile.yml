# https://taskfile.dev

version: "3"

env:
  NPM_PACKAGE: '{{ .PACKAGE | default "" }}'

tasks:
  init:
    desc: Initializes the dev environment
    cmds:
      - asdf install
      - pre-commit install
      - npm install -g @aws-amplify/cli
      - task: npm-install

  validate:
    desc: Validate the pre-commit hooks
    cmds:
      - task init
      - pre-commit run -a

  tinit:
    desc: Runs a Terraform Init
    cmds:
      - terraform init -var-file="env/main.tfvars"
    dir: terraform

  plan:
    desc: Runs a Terraform Plan
    cmds:
      - terraform plan -var-file="env/main.tfvars"
    dir: terraform

  deploy:
    desc: Runs a Terraform Apply
    cmds:
      - terraform apply -var-file="env/main.tfvars"
    dir: terraform

  npm-install:
    desc: Installs npm packages for frontend
    cmds:
      - npm install --save $NPM_PACKAGE

  serve:
    desc: Starts the react frontend
    cmds:
      # - amplify mock api &
      - npm start
